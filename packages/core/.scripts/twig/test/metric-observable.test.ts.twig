/* eslint-disable mocha/no-mocha-arrows */
// import { incValues, incValuesDelta, decValuesDelta } from './../src/test/utils/controllers';
import * as chai from 'chai';
import {describe, it} from 'mocha';
import {nanoid} from 'nanoid';
import * as sinon from 'sinon';
import * as sinonChai from 'sinon-chai';

import {{'{'}}{{metricType|capitalize}}Metric} from '../src';
import {Config} from '../src/config';
import {{'{'}}{{controllerClass}}{{'}'}} from '../src/test';
import {{'{'}}{{metricType|capitalize}}Prometheus, {{metricType|capitalize}}Statsd, TestHarness, createTestModule} from './utils';
import {endTimer} from './utils/adapters';

chai.use(sinonChai);
const expect = chai.expect;

const metricName = nanoid();

const {{metricType}}Prometheus = new {{metricType|capitalize}}Prometheus();
const {{metricType}}Statsd = new {{metricType|capitalize}}Statsd();

const metricAdapters = [
  {
    adapter: {{metricType}}Prometheus,
    metric: metricName,
  },
  {
    adapter: {{metricType}}Statsd,
    metric: metricName,
  },
];

// eslint-disable-next-line mocha/no-skipped-tests
describe('src/metric', function () {
  before(() => {
    Config.getInstance().clear();
    Config.getInstance().addAdapters(metricAdapters);
  });

  describe('Controller(Metric::{{metricType|capitalize}}Metric)', () => {
    let harness: TestHarness;
    let controller: {{metricType|capitalize}}MetricController;
    let sandbox: sinon.SinonSandbox;

    beforeEach(async () => {
      sandbox = sinon.createSandbox();
      sandbox.spy({{metricType}}Prometheus, 'observe');
      sandbox.spy({{metricType}}Prometheus, 'startTimer');
      sandbox.spy({{metricType}}Prometheus, 'reset');
      sandbox.spy({{metricType}}Statsd, 'observe');
      sandbox.spy({{metricType}}Statsd, 'startTimer');
      sandbox.spy({{metricType}}Statsd, 'reset');

      harness = await createTestModule(
        {
          adapters: [],
        },
        {
          controllers: [{{controllerClass}}],
          providers: [{{metricType|capitalize}}Metric.getProvider()],
        },
      );

      controller = harness.app.get{{'<'}}{{controllerClass}}{{'>('}}{{controllerClass}}{{')'}};
    });

    afterEach(async () => {
      await harness.app.close();

      harness = undefined;
      controller = undefined;

      sandbox.restore();
      sandbox = undefined;
    });

    {{observeTests}}

    {{timingTests}}

    {{resetTests}}

    it('generic', () => {
      expect(true).to.equal(true);
    });
  });

  it('generic', () => {
    expect(true).to.equal(true);
  });
});
